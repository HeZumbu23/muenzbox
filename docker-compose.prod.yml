# Produktions-Compose f√ºr Synology NAS
# Verwendet fertige Images von ghcr.io statt lokalem Build
#
# Erstmalig einrichten:
#   1. docker login ghcr.io -u <github-username>
#   2. cp .env.example .env  &&  nano .env
#   3. mkdir -p data
#   4. docker compose -f docker-compose.prod.yml up -d
#
# Update auf neue Version:
#   docker compose -f docker-compose.prod.yml pull && docker compose -f docker-compose.prod.yml up -d

services:
  backend:
    image: ghcr.io/hezumbu23/muenzbox-backend:latest
    container_name: muenzbox-backend
    restart: unless-stopped
    environment:
      - DATABASE_PATH=/data/muenzbox.db
    volumes:
      - muenzbox-data:/data
    networks:
      - muenzbox
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8420/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3

  frontend:
    image: ghcr.io/hezumbu23/muenzbox-frontend:latest
    container_name: muenzbox-frontend
    restart: unless-stopped
    ports:
      - "8421:8421"
    networks:
      - muenzbox
    depends_on:
      backend:
        condition: service_healthy

networks:
  muenzbox:
    driver: bridge

volumes:
  muenzbox-data:
